{% extends "base.html" %}
{% load static%}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> {% block title %}Edit Organization{% endblock %}</title>

    {% block content %}
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">


    <style>
        .login-link {
            text-align: center;
            margin-top: 20px;
        }


        .skill-selection {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }

        .skill-tag {
            background-color: #eaf2ff;
            color: #448aff;
            padding: 5px 8px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .skill-tag.selected {
            background-color: #448aff;
            color: #fff;
        }

        .skill-input-container {
            display: flex;
            align-items: center;
            border: 1px solid #ddd;
            border-radius: 25px;
            padding: 5px 10px;
        }

        .skill-input {
            border: none;
            outline: none;
            flex: 1;
            font-size: 1em;
            padding: 5px;
        }

        #selectedSkillsDisplay {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        #selectedSkillsDisplay span {
            background-color: #d4edda;
            color: #155724;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 0.9em;
            display: inline-flex;
            /* For alignment */
            align-items: center;
            /* Vertically center content */
        }

        #selectedSkillsDisplay span button {
            background: none;
            border: none;
            color: #155724;
            /* Adjust color as needed */
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 5px;
            /* Spacing between skill and "x" */
            padding: 0;
            outline: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="register-container">

            <div>
                <font style="color:red;font-size:1.5cap;">
                    {{ErrMSG}}
                </font>
            </div>

            <h1>Edit Organization</h1>

            
            <!-- <form method="POST" enctype="multipart/form-data"> -->

            <form method="post" enctype="multipart/form-data" action="{% url 'register_organization' %}">
                {% csrf_token %}

                <div class="form-wrapper">
                    <div class="register-form" id="organization-register">
                        {% csrf_token %}

                        <!-- <div class="profile-image-container">
                                <img id="profile-image-preview" src="../static/images/profile.png" alt="Profile Preview" required>
                                <label for="org_profile-image-upload" class="profile-image-upload-button">
                                    <i class="fa fa-camera"></i>
                                </label>
                                <input type="file" id="org_profile-image-upload" name="org_profile_image_upload" accept="image/*" style="display:none;" required>
                        </div> -->

                        <div class="form-group">
                            <i class="fas fa-building icon"></i>
                            <input type="text" id="org-name" name="org-name" placeholder="Organization Name" required>
                        </div>
                        <div class="form-group">
                            <i class="fas fa-envelope icon"></i>
                            <input type="email" id="org-email" name="org-email" placeholder="Email" required>
                        </div>



                        <div class="form-group">
                            <i class="fas fa-phone icon"></i>
                            <input type="tel" id="org-phone" name="org-phone" placeholder="Phone Number" required>
                        </div>

                        <p id="org-phone-error" style="color: red; font-size: 14px;"></p>


                        <div class="form-group">
                            <i class="fas fa-lock icon"></i>
                            <input type="password" id="org-password" name="org-password" placeholder="Password"
                                required>
                            <!-- <div class="password-strength"></div> -->
                        </div>

                        <div class="form-group">
                            <i class="fas fa-lock icon"></i>
                            <input type="password" id="org-confirm-password" name="org-confirm-password"
                                placeholder="Confirm Password" required>
                        </div>

                        <p id="password-error" style="color: red; font-size: 14px;"></p>

                        <div class="form-group">
                            <i class="fas fa-handshake icon"></i>
                            <select id="org-type" name="org-type" required>
                                <option value="ngo">NGO</option>
                                <option value="research">Research Group</option>
                                <option value="education">Education Institute</option>
                                <option value="charity">Charity</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <i class="fas fa-map-marker-alt icon"></i>
                            <textarea id="org-address" name="org-address" placeholder="Address" required></textarea>
                            <button type="button" class="location-button"><i class="fas fa-location-arrow"></i> Get
                                Location</button>
                        </div>

                        <button type="submit" class="register-button">Register</button>
            </form>


        </div>


    </div>
    <script src="{% static 'script.js' %}"></script>
    <script>
        function getCurrentLocation(inputId, buttonElement) {
            if (navigator.geolocation) {
                buttonElement.innerHTML = 'Locating...';
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;

                        try {
                            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                            const data = await response.json();
                            document.getElementById(inputId).value = data.display_name || `${lat}, ${lon}`;
                            buttonElement.innerHTML = '<i class="fas fa-location-arrow"></i> Location Fetched';
                        } catch (error) {
                            alert("Failed to fetch location. Please try again.");
                            buttonElement.innerHTML = '<i class="fas fa-location-arrow"></i> Try Again';
                        }
                    },
                    (error) => {
                        alert("Location access denied or unavailable.");
                        buttonElement.innerHTML = '<i class="fas fa-location-arrow"></i> Try Again';
                    }
                );
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        // Attach event listeners for both buttons after DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            const orgButton = document.querySelector('#organization-register .location-button');
            const volButton = document.querySelector('#volunteer-register .location-button');

            if (orgButton) {
                orgButton.addEventListener('click', function () {
                    getCurrentLocation('org-address', this);
                });
            }

            if (volButton) {
                volButton.addEventListener('click', function () {
                    getCurrentLocation('vol-location', this);
                });
            }
        });

        const volphone = document.getElementById("vol-phone");
        const VolPhoneErrorMsg = document.getElementById("vol-phone-error");

        volphone.addEventListener("input", function () {

            volphone.value = volphone.value.replace(/\D/g, "");

            // Limit to 10 digits only
            if (volphone.value.length > 10) {
                volphone.value = volphone.value.slice(0, 10);
            }
        });

        volphone.addEventListener("blur", function () {
            // Check if exactly 10 digits entered when user leaves the field
            if (volphone.value.length !== 10) {
                VolPhoneErrorMsg.textContent = "Phone number must be exactly 10 digits!";
                volphone.value = "";
                //   phone.focus;
            } else {
                VolPhoneErrorMsg.textContent = "";
            }
        });


        const OrgPhoneErrorMsg = document.getElementById("org-phone-error");

        const orgphone = document.getElementById("org-phone");

        orgphone.addEventListener("input", function () {

            orgphone.value = orgphone.value.replace(/\D/g, "");

            // Limit to 10 digits only
            if (orgphone.value.length > 10) {
                orgphone.value = orgphone.value.slice(0, 10);
            }
        });

        orgphone.addEventListener("blur", function () {
            // Check if exactly 10 digits entered when user leaves the field
            if (orgphone.value.length !== 10) {
                OrgPhoneErrorMsg.textContent = "Phone number must be exactly 10 digits!";
                orgphone.value = "";
                //   phone.focus;
            } else {
                OrgPhoneErrorMsg.textContent = "";
            }
        });

        // organization password validation
        const strongPassword = /^(?!.*\s)(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/;
        const orgPassword = document.getElementById("org-password");
        const orgConfirmPassword = document.getElementById("org-confirm-password");
        const errorMsg = document.getElementById("password-error");

        orgConfirmPassword.addEventListener("blur", function () {

            if (!strongPassword.test(orgPassword.value)) {
                errorMsg.textContent = "Password must be 8+ chars with uppercase, lowercase, number, and special character.";
            } else {

                if (orgConfirmPassword.value != orgPassword.value) {
                    orgConfirmPassword.value = "";
                    errorMsg.textContent = "Password not match";
                }
                else {
                    errorMsg.textContent = "";

                }

            }

        })



        // volunteer password validation
        const volPassword = document.getElementById("vol-password");
        const volConfirmPassword = document.getElementById("vol-confirm-password");
        const volErrorMsg = document.getElementById("vol-password-error");

        volConfirmPassword.addEventListener("blur", function () {

            if (!strongPassword.test(volPassword.value)) {
                volErrorMsg.textContent = "Password must be 8+ chars with uppercase, lowercase, number, and special character.";
            } else {

                if (volConfirmPassword.value != volPassword.value) {
                    volConfirmPassword.value = "";
                    volErrorMsg.textContent = "Password not match";
                }
                else {
                    volErrorMsg.textContent = "";

                }

            }

        })


    </script>

</body>

</html>
{% endblock %}